<!doctype html>
<html>
    <head>
        <title>Chatroom</title>
		<meta charset="utf-8" />
		<script src="https://cdn.wilddog.com/sdk/js/2.5.17/wilddog.js"></script>
        <script src="../js/jquery-3.2.1.min.js"></script>
		<script src="../js/jquery.xcolor.min.js"></script>
        <script>
            
            var t = new Date();
            var day = t.getDate();
            var time_h = t.getHours();
            var time_m = t.getMinutes();
            var time_s = t.getSeconds();
			
            (time_h.length < 1) ? time_hh = "0" + time_h : time_hh = time_h;/*如果不足2位，补0*/
            (time_m.length < 1) ? time_mm = "0" + time_m : time_mm = time_m;
            (time_s.length < 1) ? time_ss = "0" + time_s : time_ss = time_s;
            (day.length < 1) ? time_dd = "0" + day : time_dd = day;
				
            var time = time_hh + ":" + time_mm + ":" + time_ss;
			
			function tip(text,color) {
				var tipBox = document.getElementById("tipBox");
				var tipit=$("#tipBox");
				tipBox.innerHTML ="<br/>" + text + "<br/><br/>" ;
				$("#tipBox").css({
					backgroundColor:color,
					fontSize:"30px",
					marginLeft:"40%",
					marginRight:"40%",
					marginTop:"0%",
					marginBottom:"5%",
					textAlign:"center",
					opacity:"0",
				});
				tipit.animate({
					opacity:"0.8",
					bottom:"100px",
				},"slow");
			}
			
			var config = {
				authDomain: "https://wd6413466545jrbfqv.wilddog.com",
				syncURL: "https://wd6413466545jrbfqv.wilddogio.com"};
			wilddog.initializeApp(config);
			var msg = wilddog.sync().ref("/chat");
			
			function reg(username) {
				var userRoot = wilddog.sync().ref();
				userRoot.once("value")
					.then(function(snapshot) {
						var name = snapshot.child("/users/"+username).exists();
						if (name == false) {
							userRoot.child("users").set(username);
							userRoot.child("users/"+username).set({"name":username,"regTime":time})
						} else {
							console.error("'" +username+"'已经存在")
						}
					}
				);
			}
			
			function log(username) {
				var userRoot = wilddog.sync().ref();
				userRoot.once("value")
					.then(function(snapshot) {
						var name = snapshot.child("/users/"+username).exists();
						if (name == false) {
							console.error("'" +username+"'未注册，请用reg('"+username+"')来注册")
						} else {
							window.username = username;
						}
					}
				);
			}
			
			function msg(message,type) {
				switch (type) {
					case url:
						var msgtype = url;
						break;
					case text:
						var msgtype = text;
						break;
					case img:
						var msgtype = image;
						break;
					default:
						var msgtype = text;
						break;
				}
				
			
			}
			
			
        </script>
		<style>
			@import url(../css/chatroom.css);
		</style>
    </head>
</html>
